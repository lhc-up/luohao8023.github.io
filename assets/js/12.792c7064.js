(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{521:function(s,t,a){s.exports=a.p+"assets/img/wx-scope-1.6676d632.png"},522:function(s,t,a){s.exports=a.p+"assets/img/wx-scope-2.54d051f5.png"},523:function(s,t,a){s.exports=a.p+"assets/img/wx-scope-3.8467e272.png"},578:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"公众号网页授权"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#公众号网页授权"}},[s._v("#")]),s._v(" 公众号网页授权")]),s._v(" "),n("p",[s._v("一般指"),n("strong",[s._v("如果用户在微信客户端中访问第三方网页，公众号可以通过微信网页授权机制，来获取用户基本信息，进而实现业务逻辑。")]),n("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),n("OutboundLink")],1),n("br"),s._v("\n当然还有其他一些接口，比如获取用户地理位置、申请使用麦克风等，也需要用户授权才能使用，这些可以理解为申请权限，这里主要介绍前者，当然对于JS-SDK的使用方法及相关配置都是通用的。")]),s._v(" "),n("h2",{attrs:{id:"准备-材料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备-材料"}},[s._v("#")]),s._v(" 准备“材料”")]),s._v(" "),n("ul",[n("li",[s._v("一个已经通过"),n("strong",[s._v("微信认证")]),s._v("的"),n("strong",[s._v("服务号")]),s._v("，对于网页授权获取用户信息，必须满足这个条件，至于其他接口权限，可查看"),n("a",{attrs:{href:"https://mp.weixin.qq.com/advanced/advanced?action=table&token=2100413425&lang=zh_CN",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("确保你的域名已经通过"),n("strong",[s._v("ICP备案")])]),s._v(" "),n("li",[s._v("给你的微信号设置尽可能高的权限（对于你要开发的公众号），否则后续协调管理员扫码授权会给你带来无尽的折磨（对于中大型公司，或跨BU、BG等情况，非常浪费时间）")]),s._v(" "),n("li",[s._v("如果你是全栈工程师，可忽略这条，否则提前知会你们的后端同学，这个是需要他们全程配合的")])]),s._v(" "),n("h2",{attrs:{id:"公众号后台配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#公众号后台配置"}},[s._v("#")]),s._v(" 公众号后台配置")]),s._v(" "),n("h3",{attrs:{id:"_1、设置网页授权域名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、设置网页授权域名"}},[s._v("#")]),s._v(" 1、设置网页授权域名")]),s._v(" "),n("p",[s._v("如未配置网页授权域名，获取code时，会报redirect_uri异常。\n登录公众号后台，依次找到"),n("strong",[s._v("设置与开发-公众号设置-功能设置")]),s._v("，点击网页授权域名后的设置按钮："),n("br"),s._v(" "),n("img",{attrs:{src:a(521),alt:""}}),s._v("\n其实就是做个验证，把这个txt文件下载下来，放到域名根节点，就是通过yourdomain.com/xxxx.txt可以访问到这个txt文件（或者是放到某个路径下，如yourdomain.com/test/xxxx.txt），输入你的域名或路径，点击保存就可以了。")]),s._v(" "),n("h3",{attrs:{id:"_2、配置ip白名单"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、配置ip白名单"}},[s._v("#")]),s._v(" 2、配置ip白名单")]),s._v(" "),n("p",[s._v("早些时候是没有这个配置的，只要拿到"),n("code",[s._v("appId")]),s._v("和"),n("code",[s._v("appSecret")]),s._v("就可以调用微信的绝大多数接口了，现在有了ip白名单配置，必须在白名单内的ip才能访问接口，安全上也有了保障。"),n("br"),s._v("\n依次找到"),n("strong",[s._v("设置与开发-基本配置")]),s._v("，点击IP白名单后的设置（或查看）按钮，在输入框内填写你的服务器公网ip，如果部署到多台服务器的话，要把每台服务器的ip都写上，多个用回车分隔。点击确认修改，"),n("strong",[s._v("这个操作是需要管理员或长期运营者扫码确认的")]),s._v("。\n"),n("img",{attrs:{src:a(522),alt:""}}),s._v(" "),n("img",{attrs:{src:a(523),alt:""}})]),s._v(" "),n("h2",{attrs:{id:"前端工作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端工作"}},[s._v("#")]),s._v(" 前端工作")]),s._v(" "),n("p",[s._v("流程一定是从前端发起，由用户授权的。第一步就是获取code，这个code是干嘛的，怎么获取，详细说明可查看"),n("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),n("OutboundLink")],1),s._v("。"),n("br"),s._v("\n在合适的时机向用户发起授权申请，即打开如下页面："),n("br"),s._v(" "),n("code",[s._v("https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&redirect_uri=REDIRECT_URI&response_type=code&scope=SCOPE&state=STATE#wechat_redirect")]),n("br"),s._v("\n把"),n("code",[s._v("APPID")]),s._v("替换为你的公众号"),n("code",[s._v("appId")]),s._v("，"),n("code",[s._v("REDIRECT_URI")]),s._v("替换为回调页面地址（用户授权操作完成后，你希望打开的页面地址，微信会帮你重定向到该地址，并携带相应的参数，如code），回调页面所在域名必须与后台配置一致，"),n("code",[s._v("SCOPE")]),s._v("根据你的业务需求选择"),n("code",[s._v("snsapi_base")]),s._v("或"),n("code",[s._v("snsapi_userinfo")]),s._v("，其余参数不变。"),n("br"),s._v("\n至于使用"),n("code",[s._v("snsapi_base")]),s._v("还是"),n("code",[s._v("snsapi_userinfo")]),s._v("，具体情况具体分析：")]),s._v(" "),n("ul",[n("li",[s._v("以snsapi_base为scope发起的网页授权，是用来获取进入页面的用户的openid的，并且是静默授权并自动跳转到回调页的。用户感知的就是直接进入了回调页（往往是业务页面）")]),s._v(" "),n("li",[s._v("以snsapi_userinfo为scope发起的网页授权，是用来获取用户的基本信息的。但这种授权需要用户手动同意，并且由于用户同意过，所以无须关注，就可在授权后获取该用户的基本信息。")]),s._v(" "),n("li",[s._v("用户管理类接口中的“获取用户基本信息接口”，是在用户和公众号产生消息交互或关注后事件推送后，才能根据用户OpenID来获取用户基本信息。这个接口，包括其他微信接口，都是需要该用户（即openid）关注了公众号后，才能调用成功的。")])]),s._v(" "),n("p",[s._v("参数替换完成之后访问该页面("),n("code",[s._v("window.location.href")]),s._v("就可以)，用户授权操作完成之后，微信会重定向到"),n("code",[s._v("redirect_uri")]),s._v("，在该页面内获取"),n("code",[s._v("code")]),s._v("参数，如果不为空，则说明授权成功，然后将"),n("code",[s._v("code")]),s._v("传递给后端，至此，前端的工作基本就完成了，等待后端返回你所需的数据就可以了。")]),s._v(" "),n("h2",{attrs:{id:"后端工作-以java为例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端工作-以java为例"}},[s._v("#")]),s._v(" 后端工作（以java为例）")]),s._v(" "),n("p",[n("strong",[s._v("根据前端传入的code获取access_token和openid")])]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 通过code获取access_token")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" params "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nparams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"appid"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your appId"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nparams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"secret"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your appSecret"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nparams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code from front-end"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nparams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grant_type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"authorization_code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" httpUtil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://api.weixin.qq.com/sns/oauth2/access_token"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 解析返回值，AccessToken是事先定义好的类，和微信返回值中的字段相对应")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AccessToken")]),s._v(" accessTokenResult "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseObject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AccessToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("accessTokenResult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getErrcode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" accessTokenStr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("toJSONString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("accessTokenResult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("accessTokenStr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// errcode为空时，取出access_token")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" accessToken "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" accessTokenResult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAccess_token")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("如果前端是使用"),n("code",[s._v("snsapi_base")]),s._v("获取的code，那么到这一步也就结束了，只能拿到用户的"),n("code",[s._v("openid")]),s._v("，再往下走（获取用户信息）也是没有权限，直接返回"),n("code",[s._v("openid")]),s._v("就可以了。如果是"),n("code",[s._v("snsapi_userinfo")]),s._v("，则可以继续用"),n("code",[s._v("access_token")]),s._v("和"),n("code",[s._v("openid")]),s._v("获取用户信息。")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 根据access_token和openid获取用户信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" userInfoParams "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nuserInfoParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"access_token"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" accessTokenResult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAccess_token")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nuserInfoParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"openid"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" accessTokenResult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getOpenid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" userResult "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" httpUtil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://api.weixin.qq.com/sns/userinfo"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" userInfoParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 解析用户信息，WeChatUser是事先定义好的类，用来接收微信返回的用户信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WeChatUser")]),s._v(" weChatUser "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseObject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("userResult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WeChatUser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("weChatUser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getErrcode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JSONObject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("toJSONString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("weChatUser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("success")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("weChatUser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h2",{attrs:{id:"关于网页授权access-token和普通access-token的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关于网页授权access-token和普通access-token的区别"}},[s._v("#")]),s._v(" 关于网页授权access_token和普通access_token的区别")]),s._v(" "),n("p",[s._v("1、微信网页授权是通过OAuth2.0机制实现的，在用户授权给公众号后，公众号可以获取到一个网页授权特有的接口调用凭证（网页授权access_token），通过网页授权access_token可以进行授权后接口调用，如获取用户基本信息，没有调用次数限制，每次获取code之后要重新获取token，当然用户授权之后我们需要在自己的服务器缓存用户登录状态；"),n("br"),s._v("\n2、其他微信接口，需要通过基础支持中的“获取access_token”接口来获取到的普通access_token调用，有调用次数限制，需要在中控服务器缓存和定时刷新。")]),s._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),n("ul",[n("li",[s._v("“材料”要准备好，只有通过"),n("strong",[s._v("微信认证")]),s._v("的"),n("strong",[s._v("服务号")]),s._v("才有网页授权的接口权限；")]),s._v(" "),n("li",[s._v("确认业务需求，从而确认需要获取的"),n("code",[s._v("code")]),s._v("的权限，不要前端使用"),n("code",[s._v("snsapi_base")]),s._v("获取"),n("code",[s._v("code")]),s._v("，后端却拿着"),n("code",[s._v("code")]),s._v("去获取用户信息；")]),s._v(" "),n("li",[s._v("总体流程就是：前端拿code - 传给后端 - 后端用code获取access_token和openid - 后端拿access_token和openid获取用户信息。")])])])}),[],!1,null,null,null);t.default=e.exports}}]);